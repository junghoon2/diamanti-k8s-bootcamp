## 서버(Node) Down Test
**Kubernetes 클러스터는 Node Down 시 다른 Node에서 해당 Application(POD)를 자동 재기동하여 전체 Application 갯수를 항상 선언된 상태로 유지함**

**POD 상태 확인**
```
spkr@erdia22:~/02.k8s_code/04.Deploy$ kc get pod -o wide
NAME                       READY   STATUS    RESTARTS   AGE     IP             NODE    NOMINATED NODE   READINESS GATES
nginx01-6bdf767788-bthvn   1/1     Running   0          6m47s   10.10.100.30   dia02   <none>           <none>
nginx01-6bdf767788-shs7g   1/1     Running   0          34m     10.10.100.13   dia03   <none>           <none>
nginx01-6bdf767788-sw2jg   1/1     Running   0          19m     10.10.100.35   dia03   <none>           <none>
```

**2번 Node(dia02) Down**

drain 명령어 이용
```
spkr@erdia22:~/02.k8s_code/04.Deploy$ kc drain dia02
node/dia02 cordoned
error: unable to drain node "dia02", aborting command...

There are pending nodes to be drained:
 dia02
error: cannot delete DaemonSet-managed Pods (use --ignore-daemonsets to ignore): diamanti-system/collectd-v0.8-px5qs, diamanti-system/csi-diamanti-driver-c2xxw, diamanti-system/nfs-csi-diamanti-driver-s4vpz
```

다른 명령어와 동일하게 명령어 실행 시 error가 발생하여도 error 메시지로 바로 조치 가능

위 예제는 '--ignore-daemonsets' 옵션이 빠져서 에러 발생
```
spkr@erdia22:~/02.k8s_code/04.Deploy$ kc drain dia02 --ignore-daemonsets
node/dia02 already cordoned
WARNING: ignoring DaemonSet-managed Pods: diamanti-system/collectd-v0.8-px5qs, diamanti-system/csi-diamanti-driver-c2xxw, diamanti-system/nfs-csi-diamanti-driver-s4vpz
evicting pod "tiller-deploy-5668df8bc4-2m4pz"
evicting pod "provisioner-7b58589b9d-j82sj"
evicting pod "alertmanager-0"
evicting pod "nginx01-6bdf767788-bthvn"
evicting pod "vote-7b4c45f68d-ngcb8"
evicting pod "coredns-54d89499d4-qf8ct"
evicting pod "prometheus-v1-2"
evicting pod "myingress01-kubernetes-ingress-589649756c-ltsf4"
evicting pod "haproxy-ingress-7857555856-879qt"
evicting pod "ingress-default-backend-54b95c875b-zww8f"
pod/haproxy-ingress-7857555856-879qt evicted
pod/provisioner-7b58589b9d-j82sj evicted
pod/nginx01-6bdf767788-bthvn evicted
pod/coredns-54d89499d4-qf8ct evicted
pod/vote-7b4c45f68d-ngcb8 evicted
pod/ingress-default-backend-54b95c875b-zww8f evicted
pod/alertmanager-0 evicted
pod/prometheus-v1-2 evicted
pod/myingress01-kubernetes-ingress-589649756c-ltsf4 evicted
pod/tiller-deploy-5668df8bc4-2m4pz evicted
node/dia02 evicted
```

**2번 Node(dia02) 실행 중 Application 4번 Node(dia04) 자동 재기동 됨**
```
spkr@erdia22:~/02.k8s_code/04.Deploy$ kc get pod -o wide
NAME                       READY   STATUS    RESTARTS   AGE   IP             NODE    NOMINATED NODE   READINESS GATES
nginx01-6bdf767788-9w9vd   1/1     Running   0          37s   10.10.100.19   dia04   <none>           <none>
nginx01-6bdf767788-shs7g   1/1     Running   0          37m   10.10.100.13   dia03   <none>           <none>
nginx01-6bdf767788-sw2jg   1/1     Running   0          22m   10.10.100.35   dia03   <none>           <none>
```
